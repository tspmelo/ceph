<div class="col-sm-12 col-lg-6">
  <cd-error-panel *ngIf="imagesAll && imagesAll.length === 0"
                  [title]="'No RBD images'"
                  i18n-title
                  i18n>You must <a routerLink="/rbd/add">create a RBD image</a>
    before adding an iSCSI target.</cd-error-panel>

  <form name="targetForm"
        class="form-horizontal"
        #formDir="ngForm"
        [formGroup]="targetForm"
        novalidate>
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"
            i18n>Create Target</h3>
      </div>

      <div class="panel-body">
        <!-- Target IQN -->
        <div class="form-group"
             [ngClass]="{'has-error': targetForm.showError('targetIqn', formDir)}">
          <label i18n
                 class="control-label col-sm-3"
                 for="targetIqn">
            <ng-container i18n>Target IQN</ng-container>
            <span class="required"></span>
          </label>
          <div class="col-sm-9">
            <div class="input-group">
              <input class="form-control"
                     type="text"
                     id="targetIqn"
                     name="targetIqn"
                     formControlName="targetIqn" />
              <span class="input-group-btn">
                <button class="btn btn-default"
                        id="ecp-info-button"
                        type="button"
                        (click)="targetSettingsModal()">
                  <i class="fa fa-cogs fa-fw"
                     aria-hidden="true"></i>
                </button>
              </span>
            </div>
            <span class="help-block"
                  *ngIf="targetForm.showError('targetIqn', formDir, 'required')"
                  i18n>This field is required.</span>
            <span class="help-block"
                  *ngIf="targetForm.showError('targetIqn', formDir, 'iqn')">
              <ng-container i18n>An IQN has the following notation 'iqn.$year-$month.$reversedAddress:$definedName'</ng-container>
              <br>
              <ng-container i18n>For example: iqn.2016-06.org.dashboard:storage:disk.sn-a8675309</ng-container>
              <br>
              <a target="_blank"
                 href="https://en.wikipedia.org/wiki/ISCSI#Addressing"
                 i18n>More information</a>
            </span>
            <!-- <div class="row">
                  <div class="col-sm-12">
                    <span *ngFor="let setting of cephIscsiTargetAdvangedSettings">
                      <span ng-if="$ctrl.model.targetSettings.hasOwnProperty(setting.property)"
                            class="no-wrap margin-right-md">
                        <label>&#10551; {{ setting.property }}</label>: {{ $ctrl.model.targetSettings[setting.property] }}
                      </span>
                    </span>
                  </div>
                </div> -->
            <hr />
          </div>
        </div>

        <!-- Portals -->
        <div class="form-group"
             [ngClass]="{'has-error': targetForm.showError('portals', formDir)}">
          <label i18n
                 class="control-label col-sm-3"
                 for="portals">
            <ng-container i18n>Portals</ng-container>
            <span class="required"></span>
          </label>
          <div class="col-sm-9"
               formArrayName="portals">
            <div class="input-group cd-mb"
                 *ngFor="let portal of portals.controls; let i = index">
              <input class="form-control"
                     type="text"
                     [formControlName]="i" />
              <span class="input-group-btn">
                <button class="btn btn-default"
                        type="button"
                        (click)="removePortal(i)">
                  <i class="fa fa-remove fa-fw"
                     aria-hidden="true"></i>
                </button>
              </span>
            </div>

            <span class="help-block"
                  *ngIf="targetForm.showError('portals', formDir, 'required')"
                  i18n>At least 1 Portal is required.</span>

            <div class="row">
              <div class="col-md-12">
                <button (click)="addPortal()"
                        class="btn btn-default pull-right">
                  <i class="fa fa-fw fa-plus"></i>
                  <ng-container i18n>Add portal</ng-container>
                </button>
              </div>
            </div>

            <hr />
          </div>
        </div>

        <!-- Images -->
        <div class="form-group"
             [ngClass]="{'has-error': targetForm.showError('images', formDir)}">
          <label i18n
                 class="control-label col-sm-3"
                 for="images">
            <ng-container i18n>Images</ng-container>
            <span class="required"></span>
          </label>
          <div class="col-sm-9">
            <ng-container *ngFor="let image of targetForm.getValue('images'); let i = index">
              <div class="input-group cd-mb">
                <div class="input-group-addon"
                     i18n>lun: {{ imagesSettings[image]?.lun }}</div>
                <input class="form-control"
                       type="text"
                       [value]="image"
                       disabled />
                <span class="input-group-btn">
                  <button class="btn btn-default"
                          type="button"
                          (click)="imageSettingsModal(image)">
                    <i class="fa fa-cogs fa-fw"
                       aria-hidden="true"></i>
                  </button>
                  <button class="btn btn-default"
                          type="button"
                          (click)="removeImage(i, image)">
                    <i class="fa fa-remove fa-fw"
                       aria-hidden="true"></i>
                  </button>
                </span>
              </div>

              <!-- <span class="help-block"
                    ng-show="$ctrl.iscsiForm['image'+$index].$error.featuresValidator"
                    i18n>The RBD you've chosen contains one or more feature(s) that are not supported by iSCSI.
                Please choose another RBD.</span> -->

              <div class="row">
                <div class="col-sm-12">
                  <ng-container *ngFor="let setting of imagesSettings[image] | keyvalue">
                    <span *ngIf="setting.value"
                          class="no-wrap margin-right-md">
                      <label>{{ setting.key }}</label>: {{ setting.value }}
                    </span>
                  </ng-container>
                </div>
              </div>
            </ng-container>

            <span class="help-block"
                  *ngIf="targetForm.showError('images', formDir, 'required')"
                  i18n>At least 1 Image is required.</span>

            <div class="row">
              <div class="col-md-12">
                <cd-select [data]="images.value"
                           [options]="imagesSelections"
                           [messages]="messages"
                           (selection)="onSelection($event)"
                           elemClass="btn btn-default pull-right">
                  <i class="fa fa-fw fa-plus"></i>
                  <ng-container i18n>Add image</ng-container>
                </cd-select>
              </div>
            </div>

            <hr />
          </div>
        </div>

        <!-- Initiators -->
        <div class="form-group"
             [ngClass]="{'has-error': targetForm.showError('initiators', formDir)}">
          <label class="control-label col-sm-3"
                 for="initiators">
            <ng-container i18n>Initiators</ng-container>
            <span class="required"></span>
          </label>
          <div class="col-sm-9"
               formArrayName="initiators">
            <div class="panel panel-default"
                 *ngFor="let initiator of initiators.controls; let i = index">
              <div class="panel-heading">
                Panel heading without title
                <button type="button"
                        class="close"
                        (click)="removeInitiator(i)">
                  <i class="fa fa-remove fa-fw"></i></button>
              </div>
              <div class="panel-body">
                <!-- Initiator: Name -->
                <div class="form-group">
                  <label class="control-label col-sm-3"
                         for="name">
                    <ng-container i18n>Name</ng-container>
                    <span class="required"></span>
                  </label>
                  <div class="col-sm-9">
                    <input class="form-control"
                           type="text"
                           [formControlName]="i">
                  </div>
                </div>

                <!-- Initiator: User -->
                <div class="form-group"
                     [ngClass]="{'has-error': targetForm.showError('user', formDir)}">
                  <label class="control-label col-sm-3"
                         for="user">
                    <ng-container i18n>User</ng-container>
                    <span class="required"></span>
                  </label>
                  <div class="col-sm-9">
                    <input id="user"
                           class="form-control"
                           type="text">
                    <!-- formControlName="user" -->
                    <span class="help-block"
                          *ngIf="targetForm.showError('user', formDir, 'required')"
                          i18n>This field is required.</span>
                  </div>
                </div>

                <!-- Initiator: Password -->
                <div class="form-group"
                     [ngClass]="{'has-error': targetForm.showError('password', formDir)}">
                  <label class="control-label col-sm-3"
                         for="password">
                    <ng-container i18n>Password</ng-container>
                    <span class="required"></span>
                  </label>
                  <div class="col-sm-9">
                    <div class="input-group">
                      <input id="password"
                             class="form-control"
                             type="password">

                      <!-- formControlName="password" -->
                      <span class="input-group-btn">
                        <button type="button"
                                class="btn btn-default"
                                cdPasswordButton="password">
                        </button>
                        <button type="button"
                                class="btn btn-default"
                                cdCopy2ClipboardButton="password">
                        </button>
                      </span>
                    </div>
                    <span class="help-block"
                          *ngIf="targetForm.showError('password', formDir, 'required')"
                          i18n>This field is required.</span>
                  </div>
                </div>



                <!-- Initiator: Images -->
                <div class="form-group"
                     [ngClass]="{'has-error': targetForm.showError('images', formDir)}">
                  <label i18n
                         class="control-label col-sm-3"
                         for="images">
                    <ng-container i18n>Images</ng-container>
                  </label>
                  <div class="col-sm-9">
                    <ng-container *ngFor="let image of targetForm.getValue('images'); let i = index">
                      <div class="input-group cd-mb">
                        <div class="input-group-addon"
                             i18n>lun: {{ imagesSettings[image]?.lun }}</div>
                        <input class="form-control"
                               type="text"
                               [value]="image"
                               disabled />
                        <span class="input-group-btn">
                          <button class="btn btn-default"
                                  type="button"
                                  (click)="removeImage(i, image)">
                            <i class="fa fa-remove fa-fw"
                               aria-hidden="true"></i>
                          </button>
                        </span>
                      </div>
                    </ng-container>

                    <div class="row">
                      <div class="col-md-12">
                        <cd-select [data]="images.value"
                                   [options]="imagesSelections"
                                   [messages]="messages"
                                   (selection)="onSelection($event)"
                                   elemClass="btn btn-default pull-right">
                          <i class="fa fa-fw fa-plus"></i>
                          <ng-container i18n>Add image</ng-container>
                        </cd-select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-12">
                <button (click)="addInitiator()"
                        class="btn btn-default pull-right">
                  <i class="fa fa-fw fa-plus"></i>
                  <ng-container i18n>Add initiator</ng-container>
                </button>
              </div>
            </div>

            <hr />
          </div>
        </div>

        <!-- Groups -->
        <div class="form-group"
             [ngClass]="{'has-error': targetForm.showError('images', formDir)}">
          <label class="control-label col-sm-3"
                 for="initiators">
            <ng-container i18n>Groups</ng-container>
            <span class="required"></span>
          </label>
          <div class="col-sm-9"
               formArrayName="initiators">
            <div class="panel panel-default"
                 *ngFor="let initiator of initiators.controls; let i = index">
              <div class="panel-heading">
                Panel heading without title
                <button type="button"
                        class="close"
                        (click)="removeInitiator(i)">
                  <i class="fa fa-remove fa-fw"></i></button>
              </div>
              <div class="panel-body">
                <!-- Initiator: Name -->
                <div class="form-group">
                  <label class="control-label col-sm-3"
                         for="name">
                    <ng-container i18n>Name</ng-container>
                    <span class="required"></span>
                  </label>
                  <div class="col-sm-9">
                    <input class="form-control"
                           type="text"
                           [formControlName]="i">
                  </div>
                </div>

                <!-- Group: Initiators -->
                <div class="form-group"
                     [ngClass]="{'has-error': targetForm.showError('images', formDir)}">
                  <label i18n
                         class="control-label col-sm-3"
                         for="images">
                    <ng-container i18n>Initiators</ng-container>
                  </label>
                  <div class="col-sm-9">
                    <ng-container *ngFor="let image of targetForm.getValue('images'); let i = index">
                      <div class="input-group cd-mb">
                        <div class="input-group-addon"
                             i18n>lun: {{ imagesSettings[image]?.lun }}</div>
                        <input class="form-control"
                               type="text"
                               [value]="image"
                               disabled />
                        <span class="input-group-btn">
                          <button class="btn btn-default"
                                  type="button"
                                  (click)="removeImage(i, image)">
                            <i class="fa fa-remove fa-fw"
                               aria-hidden="true"></i>
                          </button>
                        </span>
                      </div>
                    </ng-container>

                    <div class="row">
                      <div class="col-md-12">
                        <cd-select [data]="images.value"
                                   [options]="imagesSelections"
                                   [messages]="messages"
                                   (selection)="onSelection($event)"
                                   elemClass="btn btn-default pull-right">
                          <i class="fa fa-fw fa-plus"></i>
                          <ng-container i18n>Add Initiator</ng-container>
                        </cd-select>
                      </div>
                    </div>

                    <hr />
                  </div>
                </div>

                <!-- Group: Images -->
                <div class="form-group"
                     [ngClass]="{'has-error': targetForm.showError('images', formDir)}">
                  <label i18n
                         class="control-label col-sm-3"
                         for="images">
                    <ng-container i18n>Images</ng-container>
                  </label>
                  <div class="col-sm-9">
                    <ng-container *ngFor="let image of targetForm.getValue('images'); let i = index">
                      <div class="input-group cd-mb">
                        <div class="input-group-addon"
                             i18n>lun: {{ imagesSettings[image]?.lun }}</div>
                        <input class="form-control"
                               type="text"
                               [value]="image"
                               disabled />
                        <span class="input-group-btn">
                          <button class="btn btn-default"
                                  type="button"
                                  (click)="removeImage(i, image)">
                            <i class="fa fa-remove fa-fw"
                               aria-hidden="true"></i>
                          </button>
                        </span>
                      </div>
                    </ng-container>

                    <div class="row">
                      <div class="col-md-12">
                        <cd-select [data]="images.value"
                                   [options]="imagesSelections"
                                   [messages]="messages"
                                   (selection)="onSelection($event)"
                                   elemClass="btn btn-default pull-right">
                          <i class="fa fa-fw fa-plus"></i>
                          <ng-container i18n>Add image</ng-container>
                        </cd-select>
                      </div>
                    </div>

                    <hr />
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-12">
                <button (click)="addInitiator()"
                        class="btn btn-default pull-right">
                  <i class="fa fa-fw fa-plus"></i>
                  <ng-container i18n>Add Group</ng-container>
                </button>
              </div>
            </div>
          </div>
        </div>

      </div>
      <div class="panel-footer">
        <div class="button-group text-right">
          <cd-submit-button [form]="formDir"
                            type="button"
                            (submitAction)="submit()"
                            i18n>Create Target</cd-submit-button>

          <button type="button"
                  class="btn btn-sm btn-default"
                  routerLink="/block/iscsi/targets"
                  i18n>Back</button>
        </div>
      </div>
    </div>
  </form>
</div>
